# 2. Структура Базы Данных (PostgreSQL)

Для обеспечения гибкости и масштабирования будет разработана нормализованная схема БД.

## 2.1. Основные таблицы

### Таблица `users`
Хранит учетные данные для всех ролей пользователей.

-   `id` (PK)
-   `email` (UNIQUE)
-   `password_hash`
-   `role` (ENUM: 'customer', 'supplier', 'operator')
-   `created_at`, `updated_at`

### Таблица `companies`
Хранит основную информацию о компаниях-поставщиках.

- `id`: `SERIAL PRIMARY KEY` - уникальный идентификатор компании.
- `user_id`: `INTEGER` - ссылка на `users.id` (один к одному, `UNIQUE`), владелец компании.
- `name`: `VARCHAR(255)` - краткое (фирменное) название компании.
- `full_name`: `VARCHAR(255)` - полное юридическое наименование.
- `inn`: `VARCHAR(12)` - ИНН компании, уникальное значение.
- `region`: `VARCHAR(255)` - регион регистрации.
- `website_url`: `VARCHAR(255)` - ссылка на сайт компании.
- `created_at`: `TIMESTAMP WITH TIME ZONE` - дата создания.
- `updated_at`: `TIMESTAMP WITH TIME ZONE` - дата обновления (обновляется автоматически).

### Таблица `company_contacts`
Хранит контактные данные представителей компаний. На данный момент реализована связь "один к одному" с компанией, но в будущем может быть расширена.

- `id`: `SERIAL PRIMARY KEY`
- `company_id`: `INTEGER` - ссылка на `companies.id` (`UNIQUE`).
- `full_name`: `VARCHAR(255)` - ФИО контактного лица.
- `position`: `VARCHAR(255)` - Должность.
- `phone`: `VARCHAR(50)` - Контактный телефон.
- `email`: `VARCHAR(255)` - Контактный E-mail.

### Автоматическая инициализация
Схема базы данных, включая таблицы `users`, `companies`, `company_contacts` и необходимые триггеры, автоматически разворачивается при первом запуске Docker-контейнера `postgres-db`. Скрипт инициализации находится в файле `db/init.sql`. Это гарантирует консистентность структуры БД в любой среде. **После изменения `init.sql` необходимо полностью перезапустить Docker-контейнеры с очисткой томов (`docker-compose down -v`) или использовать команду `npm run dev:fresh`.**

## 2.2. Таблицы Продуктов и Услуг

### Таблица `products`
Каталог продуктов, предлагаемых компаниями.

-   `id` (PK)
-   `company_id` (FK to `companies.id`)
-   `name`, `short_description`, `description`
-   `category_id` (FK to `categories.id`)
-   `price_model` (JSONB) - для гибкого описания стоимости (например, за пользователя, за период).
-   `is_domestic_software` (BOOLEAN)
-   `is_draft` (BOOLEAN) - для черновиков.
-   `logo_url`, `analog_url`
-   `created_at`, `updated_at`

### Таблица `services`
Каталог услуг.

-   `id` (PK)
-   `company_id` (FK to `companies.id`)
-   `name`, `short_description`
-   `category_id` (FK to `categories.id`)
-   `price_from`, `price_to`
-   `is_draft` (BOOLEAN)
-   `created_at`, `updated_at`

### Таблица `categories` (Единая для классификации)
Гибкая таблица для хранения иерархии категорий, подкатегорий и технологий.

-   `id` (PK)
-   `parent_id` (FK to `categories.id`, self-reference) - для построения иерархии.
-   `name`
-   `type` (ENUM: 'product_category', 'service_category', 'technology_stack') - тип записи.

## 2.3. Таблицы Мер поддержки и Принцип Единой Ответственности (Single Responsibility)

Изначально, данные о мерах поддержки (и желаемых, и полученных) хранились в смешанных таблицах, что приводило к сложности в аналитике и поддержке. Мы провели рефакторинг, разделив их на две узкоспециализированные таблицы, следуя **Принципу Единой Ответственности (Single Responsibility Principle)**.

Этот принцип гласит, что каждая часть вашей программы (в данном случае, каждая таблица в базе данных) должна иметь только **одну причину для изменения**.

- **`survey_support_answers`**: Её единственная ответственность — хранить ответы из анкеты. Если изменится анкета, мы будем менять только эту таблицу.
- **`operator_confirmed_grants`**: Её единственная ответственность — служить журналом фактически выданных грантов. Если изменится процесс подтверждения грантов, мы будем менять только эту таблицу.

Такое разделение делает систему более чистой, предсказуемой и легкой для масштабирования.

### Таблица `survey_support_answers`
Хранит ответы компаний из анкеты о мерах поддержки, заполняемой при регистрации поставщика.

-   `id` (PK)
-   `company_id` (FK to `companies.id`, UNIQUE)
-   `is_aware` (BOOLEAN) - Осведомленность о мерах поддержки (да/нет).
-   `main_interest` (TEXT[]) - Массив текстовых названий мер, представляющих наибольший интерес.
-   `used_federal` (TEXT[]) - Массив текстовых названий федеральных мер, которые компания **указала как использованные**.
-   `used_regional` (TEXT[]) - Массив текстовых названий региональных мер, которые компания **указала как использованные**.
-   `startup_plans` (VARCHAR) - Планы по включению в реестр ИТ-стартапов.
-   `attracting_specialists` (BOOLEAN) - Планы по привлечению специалистов из других субъектов и государств.
-   `created_at`, `updated_at` (Автоматическое обновление времени создания/обновления записи).

### Таблица `operator_confirmed_grants`
Хранит фактические, подтвержденные оператором данные о полученных грантах и других мерах поддержки.

-   `id` (PK)
-   `company_id` (FK to `companies.id`) - Ссылка на компанию, получившую поддержку.
-   `measure_type` (ENUM: 'federal', 'regional') - Тип поддержки.
-   `description` - Описание меры (например, "Грант Фонда 'Сколково'").
-   `grant_amount` (DECIMAL) - Сумма гранта.
-   `grant_year` (INTEGER) - Год получения гранта.
-   `confirmed_by_operator_id` (FK to `users.id`) - Кто из операторов подтвердил.
-   `confirmed_at` (TIMESTAMPTZ) - Дата и время подтверждения.

## 2.4. Прочие таблицы

-   **`product_files` / `service_files`**: Таблицы для хранения ссылок на связанные файлы (документы, скриншоты), загружаемые в облачное хранилище.
-   **`orders`**: Концептуальная таблица для хранения заказов от заказчиков (реализация не в приоритете MVP).